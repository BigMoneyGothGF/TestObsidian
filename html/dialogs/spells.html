<form class="obsidian" autocomplete="off">
	<details>
		<summary>
			<h3>{{localize 'OBSIDIAN.CustomSpells'}} ({{count actor.obsidian.spells.custom}})</h3>
			<i class="fas fa-angle-down"></i>
		</summary>
		{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Remove'
				spells=actor.obsidian.spells.custom btnClass='obsidian-rm-spell' filter=false}}
	</details>
	{{#each actor.obsidian.classes}}
		{{#if (not-empty (lookup ../ObsidianData.SPELLS_BY_CLASS name))}}
			<h2>{{label}}</h2>
			{{#if (eq flags.obsidian.spellcasting.preparation 'prep')}}
				{{#with (lookup ../actor.obsidian.spells name)}}
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.KnownSpells'}}</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Prepare'
								btnActive='OBSIDIAN.Prepared' filter=true active=prepared spellList=../name
								spells=(lookup ../../ObsidianData.SPELLS_BY_CLASS ../name)
								totalCantrips=../flags.obsidian.spellcasting.totalCantrips
								maxCantrips=../flags.obsidian.spellcasting.maxCantrips
								totalPrepared=../flags.obsidian.spellcasting.totalPrepared
								maxPrepared=../flags.obsidian.spellcasting.maxPrepared
								btnCantrip='OBSIDIAN.Learn' btnCantripActive='OBSIDIAN.Remove'}}
					</details>
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.PreparedSpells'}} ({{count prepared}})</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Unprepare'
								filter=false spells=prepared btnCantrip='OBSIDIAN.Remove'}}
					</details>
				{{/with}}
			{{else if (eq flags.obsidian.spellcasting.preparation 'known')}}
				{{#with (lookup ../actor.obsidian.spells name)}}
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.AddSpells'}}</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Learn'
								btnActive='OBSIDIAN.Remove' filter=true active=known
								totalKnown=../flags.obsidian.spellcasting.totalKnown
								spells=(lookup ../../ObsidianData.SPELLS_BY_CLASS ../name) spellList=../name
								totalCantrips=../flags.obsidian.spellcasting.totalCantrips
								maxCantrips=../flags.obsidian.spellcasting.maxCantrips
								maxKnown=../flags.obsidian.spellcasting.maxKnown}}
					</details>
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.KnownSpells'}} ({{count known}})</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Remove'
								btnClass='obsidian-rm-spell' filter=false spells=known}}
					</details>
				{{/with}}
			{{else if (eq flags.obsidian.spellcasting.preparation 'book')}}
				{{#with (lookup ../actor.obsidian.spells name)}}
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.AddSpells'}}</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Learn'
								btnActive='OBSIDIAN.Remove' filter=true spellList=../name active=book
								spells=(lookup ../../ObsidianData.SPELLS_BY_CLASS ../name)
								totalCantrips=../flags.obsidian.spellcasting.totalCantrips
								maxCantrips=../flags.obsidian.spellcasting.maxCantrips}}
					</details>
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.PreparedSpells'}} ({{count prepared}})</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Unprepare'
								filter=false spells=prepared btnCantrip='OBSIDIAN.Remove'}}
					</details>
					<details>
						<summary>
							<h3>{{localize 'OBSIDIAN.Spellbook'}}</h3>
							<i class="fas fa-angle-down"></i>
						</summary>
						{{> modules/obsidian/html/components/spell-list.html btn='OBSIDIAN.Prepare'
								btnActive='OBSIDIAN.Prepared' filter=true spells=book active=prepared
								totalCantrips=../flags.obsidian.spellcasting.totalCantrips
								maxCantrips=../flags.obsidian.spellcasting.maxCantrips
								totalPrepared=../flags.obsidian.spellcasting.totalPrepared
								maxPrepared=../flags.obsidian.spellcasting.maxPrepared
								btnCantripActive='OBSIDIAN.Remove'}}
					</details>
				{{/with}}
			{{/if}}
		{{/if}}
	{{/each}}
</form>
