<form class="obsidian" autocomplete="off" data-name="feature">
	<input type="hidden" name="flags.obsidian.features.custom.{{featureID}}.custom" value="true"
	       data-dtype="Boolean">
	<fieldset>
		<legend>{{localize 'OBSIDIAN.Feature'}}</legend>
		<div class="obsidian-form-row obsidian-mixed-form-row obsidian-inline">
			<input class="obsidian-input-compact" type="text" value="{{feature.label}}"
			       placeholder="{{localize 'OBSIDIAN.Feature'}}"
			       name="flags.obsidian.features.custom.{{featureID}}.label">
			<select name="flags.obsidian.features.custom.{{featureID}}.active"
			        class="obsidian-feat-active">
				{{#select feature.active}}
					{{#each ObsidianRules.FEAT_ACTIVE}}
						<option value="{{this}}">{{localize (expr '+' 'OBSIDIAN.FeatActive-' this)}}</option>
					{{/each}}
				{{/select}}
			</select>
			<select name="flags.obsidian.features.custom.{{featureID}}.action"
			        class="{{#if (expr '===' 'passive' feature.active)}}obsidian-hidden{{/if}}">
				{{#select feature.action}}
					{{#each ObsidianRules.FEAT_ACTION}}
						<option value="{{this}}">{{localize (expr '+' 'OBSIDIAN.FeatAction-' this)}}</option>
					{{/each}}
				{{/select}}
			</select>
		</div>
		<div class="obsidian-form-row obsidian-mixed-form-row obsidian-inline">
			<select name="flags.obsidian.features.custom.{{featureID}}.source.type"
			        class="obsidian-feat-source">
				{{#select feature.source.type}}
					{{#each ObsidianRules.FEAT_SOURCE_TYPES}}
						<option value="{{this}}">{{localize (expr '+' 'OBSIDIAN.FeatSrc-' this)}}</option>
					{{/each}}
				{{/select}}
			</select>
			<select name="flags.obsidian.features.custom.{{featureID}}.source.class" data-dtype="Number"
			        class="{{#if (expr '!' (expr '===' feature.source.type 'class'))~}}
			          obsidian-hidden
			        {{~/if}} obsidian-feat-source-class">
				{{#select feature.source.class}}
					{{#each entity.data.flags.obsidian.classes as |class id|}}
						<option value="{{id}}">{{class.label}}</option>
					{{/each}}
				{{/select}}
			</select>
			<select name="flags.obsidian.features.custom.{{featureID}}.source.level" data-dtype="Number"
			        class="{{#if (expr '!' (expr '===' feature.source.type 'feat'))~}}
			          obsidian-hidden
			        {{~/if}} obsidian-feat-source-level">
				{{#select feature.source.level}}
					{{#each (range 1 data.attributes.level.value)}}
						<option value="{{this}}">{{this}}</option>
					{{/each}}
				{{/select}}
			</select>
			<input type="text" name="flags.obsidian.features.custom.{{featureID}}.source.other"
			       placeholder="{{localize 'OBSIDIAN.Source'}}" value="{{feature.source.other}}"
			       class="{{#if (expr '!' (expr '===' feature.source.type 'other'))~}}
			        obsidian-hidden
			       {{~/if}} obsidian-input-compact obsidian-input-lg">
		</div>
	</fieldset>
	<fieldset {{disabled (expr '!' feature.uses.enabled)}}>
		<legend>
			<div class="fancy-checkbox"
			     data-bound="flags.obsidian.features.custom.{{featureID}}.uses.enabled">
				<div class="checkbox-container">
					<div class="checkbox-inner-box"></div>
					<div class="checkmark-container">
						<div class="checkmark">
							<div class="checkmark-short"></div>
							<div class="checkmark-long"></div>
						</div>
					</div>
				</div>
				<div class="checkbox-content">{{localize 'OBSIDIAN.Uses'}}</div>
			</div>
			<input type="checkbox" name="flags.obsidian.features.custom.{{featureID}}.uses.enabled"
			       class="obsidian-hidden" {{checked feature.uses.enabled}}>
		</legend>
		<div class="obsidian-form-row obsidian-mixed-form-row obsidian-inline">
			<input type="text" class="obsidian-input-compact obsidian-input-num obsidian-input-num-sm"
			       data-dtype="Number" placeholder="0" value="{{feature.uses.bonus}}"
			       name="flags.obsidian.features.custom.{{featureID}}.uses.bonus">
			<span class="obsidian-binary-operator">&plus;</span>
			<select name="flags.obsidian.features.custom.{{featureID}}.uses.key"
			        class="obsidian-feat-uses-key">
				{{#select feature.uses.key}}
					<option value="">&mdash;</option>
					{{#each ObsidianRules.FEAT_USES_KEYS}}
						<option value="{{this}}">{{localize (expr '+' 'OBSIDIAN.UsesKey-' this)}}</option>
					{{/each}}
				{{/select}}
			</select>
			<select name="flags.obsidian.features.custom.{{featureID}}.uses.ability"
			        class="{{#if (expr '!' (expr '===' feature.uses.key 'abl'))~}}
				        obsidian-hidden
			        {{~/if}} obsidian-feat-uses-ability">
				{{#select feature.uses.ability}}
					{{#each data.abilities}}
						<option value="{{@key}}">{{localize (expr '+' 'OBSIDIAN.Ability-' @key)}}</option>
					{{/each}}
				{{/select}}
			</select>
			<select name="flags.obsidian.features.custom.{{featureID}}.uses.class"
			        class="{{#if (expr '!' (expr '===' feature.uses.key 'cls'))~}}
				        obsidian-hidden
			        {{~/if}} obsidian-feat-uses-class">
				{{#select feature.uses.class}}
					{{#each entity.data.flags.obsidian.classes as |class id|}}
						<option value="{{id}}">{{class.label}}</option>
					{{/each}}
				{{/select}}
			</select>
		</div>
	</fieldset>
	<fieldset {{disabled (expr '!' feature.dc.enabled)}}>
		<legend>
			<div class="fancy-checkbox"
			     data-bound="flags.obsidian.features.custom.{{featureID}}.dc.enabled">
				<div class="checkbox-container">
					<div class="checkbox-inner-box"></div>
					<div class="checkmark-container">
						<div class="checkmark">
							<div class="checkmark-short"></div>
							<div class="checkmark-long"></div>
						</div>
					</div>
				</div>
				<div class="checkbox-content">{{localize 'OBSIDIAN.DC'}}</div>
			</div>
			<input type="checkbox" name="flags.obsidian.features.custom.{{featureID}}.dc.enabled"
			       class="obsidian-hidden" {{checked feature.dc.enabled}}>
		</legend>
		<div class="obsidian-form-row obsidian-mixed-form-row obsidian-inline">
			<input type="text" name="flags.obsidian.features.custom.{{featureID}}.dc.bonus"
			       placeholder="8" value="{{feature.dc.bonus}}"
			       class="obsidian-input-compact obsidian-input-num obsidian-input-num-sm">
			<span class="obsidian-binary-operator">&plus;</span>
			<select name="flags.obsidian.features.custom.{{featureID}}.dc.prof" data-dtype="Number">
				{{#select feature.dc.prof}}
					<option value="">&mdash;</option>
					{{#each ObsidianRules.PLUS_PROF}}
						<option value="{{@key}}">{{localize (expr '+' 'OBSIDIAN.PlusProf-' this)}}</option>
					{{/each}}
				{{/select}}
			</select>
			<span class="obsidian-binary-operator">&plus;</span>
			<select name="flags.obsidian.features.custom.{{featureID}}.dc.ability">
				{{#select feature.dc.ability}}
					<option value="">&mdash;</option>
					{{#each data.abilities}}
						<option value="{{@key}}">{{localize (expr '+' 'OBSIDIAN.Ability-' @key)}}</option>
					{{/each}}
				{{/select}}
			</select>
		</div>
	</fieldset>
	<label class="obsidian-label-lg">{{localize 'OBSIDIAN.Description'}}</label>
	<div class="obsidian-rich-text">
		{{editor content=feature.desc button=false editable=editable
		         target=(expr '+' 'flags.obsidian.features.custom.' featureID '.desc')}}
	</div>
</form>
