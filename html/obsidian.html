<form class="obsidian {{cssClass}}" autocomplete="off">
	<section class="obsidian-sidebar">
		<img class="obsidian-profile-img obsidian-ptr" src="{{actor.img}}" title="{{actor.name}}"
		     alt="{{actor.name}}" data-edit="img">
		<div class="obsidian-collapser-container obsidian-ptr">
			<i class="fas fa-angle-double-down fa-rotate-90"></i>
		</div>
	</section>
	<section class="obsidian-char-overview">
		<div class="obsidian-char-header-container">
			<div class="obsidian-char-header">
				<input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"
				       class="obsidian-char-charname obsidian-condensed">
				<div class="obsidian-char-header-minor obsidian-condensed">
					{{#if entity.flags.obsidian.details.gender}}
						<span>{{entity.flags.obsidian.details.gender}}</span>
					{{/if}}
					{{#if entity.flags.obsidian.details.subrace}}
						<span class="obsidian-joined">{{entity.flags.obsidian.details.subrace}}</span>
					{{/if}}
					<span>
						{{#if data.details.race.value}}
							{{data.details.race.value}}
						{{else}}
							Race
						{{/if}}
					</span>
					<span>{{classFormat entity.flags.obsidian.classes}}</span>
					<a title="Edit Details" class="obsidian-edit">
						<i class="fas fa-edit"></i>
					</a>
				</div>
				<div class="obsidian-char-xp obsidian-ptr">
					<div class="obsidian-char-xp-bar">
						<span class="obsidian-char-lvl obsidian-condensed">
							LVL {{data.details.level.value}}
						</span>
						<span class="obsidian-char-xp-progress">
							<span class="obsidian-char-xp-progress-bar" style="width:
								{{~#if (expr '>=' data.details.xp.value data.details.xp.max)~}}
									100
								{{~else~}}
									{{~data.details.xp.pct~}}
								{{~/if~}}%;"></span>
						</span>
						<span class="obsidian-char-lvl obsidian-condensed">
							{{#if (expr '>=' data.details.level.value ObsidianRules.MAX_LEVEL)}}
								MAX
							{{else}}
								LVL {{expr '+' data.details.level.value 1}}
							{{/if}}
						</span>
					</div>
					<div class="obsidian-char-xp-data">
						{{#if entity.flags.obsidian.details.milestone}}
							Milestone
						{{else}}
							{{data.details.xp.value}} / {{data.details.xp.max}} XP
						{{/if}}
					</div>
				</div>
			</div>
			<div class="obsidian-char-top-level">
				<div class="obsidian-char-column" style="padding-right: 2px;">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">Proficiency</div>
						<div class="obsidian-char-box">
							{{numberFormat data.attributes.prof.value decimals=0 sign=true}}
						</div>
					</div>
					<button type="button" class="obsidian-btn-outline obsidian-btn-sm obsidian-char-rest
					        obsidian-short-rest">
						<i class="fas fa-hourglass-half"></i>
						Short Rest
					</button>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">Inspiration</div>
						<div class="obsidian-char-box obsidian-inspiration obsidian-ptr">
							<i class="fas fa-sun {{#if (expr '!' entity.flags.obsidian.details.inspiration)~}}
								obsidian-hidden
							{{~/if}}"></i>
						</div>
					</div>
					<button type="button" class="obsidian-btn-outline obsidian-btn-sm obsidian-char-rest
					        obsidian-long-rest">
						<i class="fas fa-campground"></i>
						Long Rest
					</button>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">Speed</div>
						{{#if entity.flags.obsidian.attributes.speedDisplay}}
							<div class="obsidian-char-box-text" style="color: var(--text-subtle);">
								{{lookup ObsidianRules.Speeds entity.flags.obsidian.attributes.speedDisplay}}
							</div>
						{{/if}}
						<div class="obsidian-char-box obsidian-speed obsidian-ptr">
							{{#with entity.flags.obsidian.attributes as |attr|}}
								{{#if attr.speedDisplay}}
									{{#with (lookup attr.speed attr.speedDisplay) as |spd|}}
										{{#if spd.override}}
											{{spd.override}}
										{{else}}
											{{spd.value}}
										{{/if}}
									{{/with}}
								{{/if}}
							{{/with}}
						</div>
					</div>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text rollable">Initiative</div>
						<div class="obsidian-char-box obsidian-init obsidian-ptr">
							{{numberFormat data.attributes.init.mod decimals=0 sign=true}}
						</div>
					</div>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">AC</div>
						<div class="obsidian-char-box obsidian-ac obsidian-ptr">{{data.attributes.ac.min}}</div>
					</div>
				</div>
			</div>
		</div>
		<div class="obsidian-char-header-container">
			<div class="obsidian-char-abilities">
				{{#each data.abilities as |ability id|}}
				<div class="obsidian-char-ability">
					<div class="obsidian-char-ability-name rollable obsidian-condensed">{{id}}</div>
					<div class="obsidian-char-ability-mod">
						{{numberFormat ability.mod decimals=0 sign=true}}
					</div>
					<input name="data.abilities.{{id}}.value" type="text" value="{{ability.value}}"
					       placeholder="10" class="obsidian-char-ability-score">
				</div>
				{{/each}}
			</div>
			<div class="obsidian-char-top-level">
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">Hit Points</div>
						<div class="obsidian-char-box obsidian-resource-box obsidian-char-hp">
							<div class="obsidian-bisect">
								<input type="text" name="data.attributes.hp.value" class="obsidian-input-num"
								       value="{{data.attributes.hp.value}}">
								/
								<div class="obsidian-ptr obsidian-max-hp obsidian-resource-box-max
								{{#if (expr '>' data.attributes.hp.maxAdjusted data.attributes.hp.max)~}}
									obsidian-positive
								{{else if (expr '<' data.attributes.hp.maxAdjusted data.attributes.hp.max)~}}
									obsidian-negative
								{{~/if}}">
									{{data.attributes.hp.maxAdjusted}}
								</div>
							</div>
							<input type="text" name="data.attributes.hp.temp" value="{{data.attributes.hp.temp}}"
							       class="obsidian-input-num" placeholder="tmp">
						</div>
					</div>
				</div>
				{{#if (notEmpty entity.flags.obsidian.attributes.hd)}}
					<div class="obsidian-char-column">
						<div class="obsidian-char-box-container">
							<div class="obsidian-char-box-text rollable">Hit Dice</div>
							<div class="obsidian-char-box obsidian-resource-box obsidian-char-hd">
								<div>
									{{#each entity.flags.obsidian.attributes.hd as |hd id|}}
										<div class="obsidian-bisect">
											<input type="text" name="flags.obsidian.attributes.hd.{{id}}.value"
											       class="obsidian-input-num" value="{{hd.value}}">
											/
											<div class="obsidian-ptr obsidian-resource-box-max
									{{#if (defined hd.override)~}}
												{{#if (expr '>' hd.override hd.max)~}}
											obsidian-positive
										{{else if (expr '<' hd.override hd.max)~}}
											obsidian-negative
										{{~/if}}
											{{~/if}}">
												{{#if (defined hd.override)}}
													{{hd.override}}
												{{else}}
													{{hd.max}}
												{{/if}}
											</div>
											<div class="obsidian-resource-box-subtle">d{{id}}</div>
										</div>
									{{/each}}
								</div>
							</div>
						</div>
					</div>
				{{/if}}
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">Defenses</div>
						<div class="obsidian-char-box obsidian-list-box obsidian-defenses"></div>
					</div>
				</div>
			</div>
		</div>
		<section class="obsidian-char-details">
			<div class="obsidian-char-box-container">
				<div class="obsidian-char-box-text">
					Skills
					<a title="Edit Skills" class="obsidian-edit">
						<i class="fas fa-edit"></i>
					</a>
				</div>
				<div class="obsidian-char-box obsidian-skills-box">
					{{#each data.skills as |skill id|}}
						<div class="obsidian-skill-item" data-skill-id="{{id}}">
							<div class="obsidian-prof obsidian-ptr {{#if (expr '===' 0.5 skill.value)~}}
								obsidian-half-proficient
							{{~else if (expr '===' 1 skill.value)~}}
								obsidian-proficient
							{{~else if (expr '===' 2 skill.value)~}}
								obsidian-expertise
							{{~else~}}
								obsidian-not-proficient
							{{~/if~}}">
								<span></span>
							</div>
							<select name="data.skills.{{id}}.ability">
								{{#select (lc skill.ability)}}
									{{#each ../data.abilities}}
										<option value="{{@key}}">{{@key}}</option>
									{{/each}}
								{{/select}}
							</select>
							<div class="obsidian-skill-name rollable">{{skill.label}}</div>
							<div class="obsidian-skill-mod obsidian-ptr">
								{{numberFormat skill.mod decimals=0 sign=true}}
							</div>
							<div class="obsidian-skill-passive obsidian-ptr">({{expr '+' skill.mod 10}})</div>
						</div>
					{{/each}}
				</div>
			</div>
		</section>
	</section>
</form>
