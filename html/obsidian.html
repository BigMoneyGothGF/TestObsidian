<form class="obsidian {{cssClass}}" autocomplete="off">
	<section class="obsidian-sidebar">
		<img class="obsidian-profile-img obsidian-ptr" src="{{actor.img}}" title="{{actor.name}}"
		     alt="{{actor.name}}" data-edit="img">
		<div class="obsidian-char-box-container obsidian-char-box-stacked">
			<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.PersonalityTraits'}}</div>
			<div class="obsidian-char-box" contenteditable="true" data-prop="data.details.trait.value">
				{{{data.details.trait.value}}}
			</div>
		</div>
		<div class="obsidian-char-box-container obsidian-char-box-stacked">
			<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Ideals'}}</div>
			<div class="obsidian-char-box" contenteditable="true" data-prop="data.details.ideal.value">
				{{{data.details.ideal.value}}}
			</div>
		</div>
		<div class="obsidian-char-box-container obsidian-char-box-stacked">
			<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Bonds'}}</div>
			<div class="obsidian-char-box" contenteditable="true" data-prop="data.details.bond.value">
				{{{data.details.bond.value}}}
			</div>
		</div>
		<div class="obsidian-char-box-container obsidian-char-box-stacked">
			<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Flaws'}}</div>
			<div class="obsidian-char-box" contenteditable="true" data-prop="data.details.flaw.value">
				{{{data.details.flaw.value}}}
			</div>
		</div>
		<div class="obsidian-collapser-container obsidian-ptr">
			<i class="fas fa-angle-double-down fa-rotate-90"></i>
		</div>
	</section>
	<section class="obsidian-char-overview">
		<div class="obsidian-char-header-container">
			<div class="obsidian-char-header">
				<input name="name" type="text" value="{{actor.name}}"
				       placeholder="{{localize OBSIDIAN.CharacterName}}"
				       class="obsidian-char-charname obsidian-condensed">
				<div class="obsidian-char-header-minor obsidian-condensed">
					{{#if entity.flags.obsidian.details.gender}}
						<span>{{entity.flags.obsidian.details.gender}}</span>
					{{/if}}
					{{#if entity.flags.obsidian.details.subrace}}
						<span class="obsidian-joined">{{entity.flags.obsidian.details.subrace}}</span>
					{{/if}}
					<span>
						{{#if data.details.race.value}}
							{{data.details.race.value}}
						{{else}}
							{{localize 'OBSIDIAN.Race'}}
						{{/if}}
					</span>
					<span>{{entity.obsidian.classFormat}}</span>
					<a title="{{localize 'OBSIDIAN.EditDetails'}}" class="obsidian-edit"
					   data-dialog="HeaderDetails">
						<i class="fas fa-edit"></i>
					</a>
				</div>
				<div class="obsidian-char-xp obsidian-ptr" data-dialog="XP">
					<div class="obsidian-char-xp-bar">
						<span class="obsidian-char-lvl obsidian-condensed">
							{{localize 'OBSIDIAN.LevelAbbrUC'}} {{data.details.level.value}}
						</span>
						<span class="obsidian-char-xp-progress">
							<span class="obsidian-char-xp-progress-bar" style="width:
								{{~#if (expr '>=' data.details.xp.value data.details.xp.max)~}}
									100
								{{~else~}}
									{{~data.details.xp.pct~}}
								{{~/if~}}%;"></span>
						</span>
						<span class="obsidian-char-lvl obsidian-condensed">
							{{#if (expr '>=' data.details.level.value ObsidianRules.MAX_LEVEL)}}
								{{localize 'OBSIDIAN.MaximumAbbrUC'}}
							{{else}}
								{{localize 'OBSIDIAN.LevelAbbrUC'}} {{expr '+' data.details.level.value 1}}
							{{/if}}
						</span>
					</div>
					<div class="obsidian-char-xp-data">
						{{#if entity.flags.obsidian.details.milestone}}
							{{localize 'OBSIDIAN.Milestone'}}
						{{else}}
							{{data.details.xp.value}} / {{data.details.xp.max}} {{localize 'OBSIDIAN.XP'}}
						{{/if}}
					</div>
				</div>
			</div>
			<div class="obsidian-char-top-level">
				<div class="obsidian-char-column" style="padding-right: 2px;">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Proficiency'}}</div>
						<div class="obsidian-char-box">
							{{numberFormat data.attributes.prof.value decimals=0 sign=true}}
						</div>
					</div>
					<button type="button" class="obsidian-btn-outline obsidian-btn-sm obsidian-char-rest
					        obsidian-short-rest">
						<i class="fas fa-hourglass-half"></i>
						{{localize 'OBSIDIAN.ShortRest'}}
					</button>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Inspiration'}}</div>
						<div class="obsidian-char-box obsidian-inspiration obsidian-ptr">
							<i class="fas fa-sun {{#if (expr '!' data.attributes.inspiration.value)~}}
								obsidian-hidden
							{{~/if}}"></i>
						</div>
					</div>
					<button type="button" class="obsidian-btn-outline obsidian-btn-sm obsidian-char-rest
					        obsidian-long-rest">
						<i class="fas fa-campground"></i>
						{{localize 'OBSIDIAN.LongRest'}}
					</button>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Speed'}}</div>
						{{#if entity.flags.obsidian.attributes.speedDisplay}}
							<div class="obsidian-char-box-text" style="color: var(--text-subtle);">
								{{i18n-join 'OBSIDIAN.Speed-' entity.flags.obsidian.attributes.speedDisplay}}
							</div>
						{{/if}}
						<div class="obsidian-char-box obsidian-speed obsidian-ptr obsidian-simple-dialog"
						     data-title="{{localize 'OBSIDIAN.ManageSpeed'}}" data-width="250"
						     data-template="speed.html">
							{{#with entity.flags.obsidian.attributes as |attr|}}
								{{#if attr.speedDisplay}}
									{{#with (lookup attr.speed attr.speedDisplay) as |spd|}}
										{{#if spd.override}}
											{{spd.override}}
										{{else}}
											{{spd.value}}
										{{/if}}
									{{/with}}
								{{/if}}
							{{/with}}
						</div>
					</div>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text rollable">{{localize 'OBSIDIAN.Initiative'}}</div>
						<div class="obsidian-char-box obsidian-init obsidian-ptr obsidian-simple-dialog"
						     data-title="{{localize 'OBSIDIAN.ManageInitiative'}}" data-width="250"
						     data-template="init.html">
							{{numberFormat data.attributes.init.mod decimals=0 sign=true}}
						</div>
					</div>
				</div>
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.ACAbbr'}}</div>
						<div class="obsidian-char-box obsidian-ac obsidian-ptr obsidian-simple-dialog"
						     data-title="{{localize 'OBSIDIAN.ManageAC'}}" data-template="ac.html">
							{{data.attributes.ac.min}}
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="obsidian-char-header-container">
			<div class="obsidian-char-abilities">
				{{#each data.abilities as |ability id|}}
				<div class="obsidian-char-ability">
					<div class="obsidian-char-ability-name rollable obsidian-condensed">
						{{i18n-join 'OBSIDIAN.AbilityAbbr-' id}}
					</div>
					<div class="obsidian-char-ability-mod">
						{{numberFormat ability.mod decimals=0 sign=true}}
					</div>
					<input name="data.abilities.{{id}}.value" type="text" value="{{ability.value}}"
					       placeholder="10" class="obsidian-char-ability-score" data-dtype="Number">
				</div>
				{{/each}}
			</div>
			<div class="obsidian-char-top-level">
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.HP'}}</div>
						<div class="obsidian-char-box obsidian-resource-box obsidian-char-hp">
							<div class="obsidian-bisect">
								<input type="text" name="data.attributes.hp.value" class="obsidian-input-num"
								       value="{{data.attributes.hp.value}}" data-dtype="Number">
								/
								<div class="obsidian-ptr obsidian-max-hp obsidian-resource-box-max
								{{#if (expr '>' data.attributes.hp.maxAdjusted data.attributes.hp.max)~}}
									obsidian-positive
								{{else if (expr '<' data.attributes.hp.maxAdjusted data.attributes.hp.max)~}}
									obsidian-negative
								{{~/if}} obsidian-simple-dialog" data-title="{{localize 'OBSIDIAN.EditMaxHP'}}"
								     data-width="250" data-template="hp.html">
									{{data.attributes.hp.maxAdjusted}}
								</div>
							</div>
							<input type="text" name="data.attributes.hp.temp" value="{{data.attributes.hp.temp}}"
							       class="obsidian-input-num" placeholder="tmp" data-dtype="Number">
						</div>
					</div>
				</div>
				{{#if (notEmpty entity.flags.obsidian.attributes.hd)}}
					<div class="obsidian-char-column">
						<div class="obsidian-char-box-container">
							<div class="obsidian-char-box-text rollable">{{localize 'OBSIDIAN.HD'}}</div>
							<div class="obsidian-char-box obsidian-resource-box obsidian-char-hd">
								<div>
									{{#each entity.flags.obsidian.attributes.hd as |hd id|}}
										<div class="obsidian-bisect">
											<input type="text" name="flags.obsidian.attributes.hd.{{id}}.value"
											       class="obsidian-input-num" value="{{hd.value}}" data-dtype="Number">
											/
											<div class="obsidian-ptr obsidian-resource-box-max
											{{#if (defined hd.override)~}}
												{{#if (expr '>' hd.override hd.max)~}}
													obsidian-positive
												{{else if (expr '<' hd.override hd.max)~}}
													obsidian-negative
												{{~/if}}
											{{~/if}}" data-dialog="HD">
												{{#if (defined hd.override)}}
													{{hd.override}}
												{{else}}
													{{hd.max}}
												{{/if}}
											</div>
											<div class="obsidian-resource-box-subtle">d{{id}}</div>
										</div>
									{{/each}}
								</div>
							</div>
						</div>
					</div>
				{{/if}}
				<div class="obsidian-char-column">
					<div class="obsidian-char-box-container">
						<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Defenses'}}</div>
						<div class="obsidian-char-box obsidian-list-box obsidian-defenses"></div>
					</div>
				</div>
			</div>
		</div>
		<section class="obsidian-char-details">
			<div style="grid-row: 1 / span 2;" class="obsidian-main-left">
				<div class="obsidian-char-box-container">
					<div class="obsidian-char-box-text">
						{{localize 'OBSIDIAN.Skills'}}
						<a title="Edit Skills" class="obsidian-edit" data-dialog="Skills"
						   data-data-path="flags.obsidian.skills.custom" data-template="skills.html"
						   data-title="{{localize 'OBSIDIAN.ManageSkills'}}">
							<i class="fas fa-edit"></i>
						</a>
					</div>
					<div class="obsidian-char-box obsidian-skills-box">
						{{#each entity.obsidian.skills as |skill id|}}
							<div class="obsidian-skill-item" data-skill-id="{{id}}">
								<div class="obsidian-prof obsidian-ptr {{#if (expr '===' 0.5 skill.value)~}}
									obsidian-half-proficient
								{{~else if (expr '===' 1 skill.value)~}}
									obsidian-proficient
								{{~else if (expr '===' 2 skill.value)~}}
									obsidian-expertise
								{{~else if (expr '&&' ../entity.flags.obsidian.skills.joat (expr '===' 0 skill.value))~}}
									obsidian-half-proficient
								{{~else~}}
									obsidian-not-proficient
								{{~/if~}}">
									<span></span>
								</div>
								<select name="flags.obsidian.skills.{{id}}.ability">
									{{#select (lc skill.ability)}}
										{{#each ../data.abilities}}
											<option value="{{@key}}">
												{{i18n-join 'OBSIDIAN.AbilityAbbr-' @key}}
											</option>
										{{/each}}
									{{/select}}
								</select>
								<div class="obsidian-skill-name rollable">
									{{#if skill.custom}}
										{{skill.label}}
									{{else}}
										{{i18n-join 'OBSIDIAN.Skill-' id}}
									{{/if}}
								</div>
								<div class="obsidian-skill-mod obsidian-ptr">
									{{numberFormat skill.mod decimals=0 sign=true}}
								</div>
								<div class="obsidian-skill-passive">({{skill.passive}})</div>
							</div>
						{{/each}}
					</div>
				</div>
				<div class="obsidian-char-box-container obsidian-char-box-stacked">
					<div class="obsidian-char-box-text">
						{{localize 'OBSIDIAN.Tools'}}
						<a title="{{localize 'OBSIDIAN.ManageTools'}}" class="obsidian-edit"
						   data-title="{{localize 'OBSIDIAN.ManageTools'}}" data-dialog="Skills"
						   data-data-path="flags.obsidian.skills.tools" data-template="tools.html">
							<i class="fas fa-edit"></i>
						</a>
					</div>
					<div class="obsidian-char-box obsidian-skills-box">
						{{#each entity.flags.obsidian.skills.tools as |tool id|}}
							<div class="obsidian-skill-item" data-skill-id="tools.{{id}}">
								<div class="
								{{~#if (expr '===' 0.5 tool.value)~}}
									obsidian-half-proficient
								{{~else if (expr '===' 1 tool.value)~}}
									obsidian-proficient
								{{~else if (expr '===' 2 tool.value)~}}
									obsidian-expertise
								{{~else if (expr '&&' ../entity.flags.obsidian.skills.joat (expr '===' 0 tool.value))~}}
									obsidian-half-proficient
								{{~else~}}
									obsidian-not-proficient
								{{~/if}} obsidian-prof obsidian-ptr">
									<span></span>
								</div>
								<select name="flags.obsidian.skills.tools.{{id}}.ability">
									{{#select (lc tool.ability)}}
										{{#each ../data.abilities}}
											<option value="{{@key}}">
												{{i18n-join 'OBSIDIAN.AbilityAbbr-' @key}}
											</option>
										{{/each}}
									{{/select}}
								</select>
								<div class="obsidian-skill-name rollable">{{tool.label}}</div>
								<div class="obsidian-skill-mod obsidian-ptr">
									{{numberFormat tool.mod decimals=0 sign=true}}
								</div>
							</div>
						{{/each}}
					</div>
				</div>
				<div class="obsidian-char-box-container obsidian-char-box-stacked">
					<div class="obsidian-char-box-text">
						{{localize 'OBSIDIAN.Senses'}}
						<a title="{{localize 'OBSIDIAN.EditSenses'}}" class="obsidian-edit"
						   data-dialog="Senses">
							<i class="fas fa-edit"></i>
						</a>
					</div>
					<div class="obsidian-char-box obsidian-skills-box">
						{{#each entity.flags.obsidian.skills.passives}}
						{{#with (get-property ../entity.flags.obsidian.skills this)}}
							<div class="obsidian-passive-item">
								<div class="obsidian-skill-name">{{localize 'OBSIDIAN.Passive'}} {{label}}</div>
								<div class="obsidian-skill-passive">{{passive}}</div>
							</div>
						{{/with}}
						{{/each}}
						{{#if (nonZero entity.flags.obsidian.attributes.senses 'radius')}}
						<div class="obsidian-horizontal-list">
							{{#each entity.flags.obsidian.attributes.senses as |sense id|}}
								{{#if (expr '>' sense.radius 0)}}
									<span>
										{{i18n-join 'OBSIDIAN.Sense-' id}}&nbsp;{{sense.radius}}&nbsp;{{localize 'OBSIDIAN.FeetAbbr'}}
									</span>
								{{/if}}
							{{/each}}
						</div>
						{{/if}}
					</div>
				</div>
				<div class="obsidian-char-box-container obsidian-char-box-stacked">
					<div class="obsidian-char-box-text">
						{{localize 'OBSIDIAN.Proficiencies'}}
						<a title="{{localize 'OBSIDIAN.EditProficiencies'}}" class="obsidian-edit"
						   data-dialog="Proficiencies">
							<i class="fas fa-edit"></i>
						</a>
					</div>
					<div class="obsidian-char-box obsidian-skills-box">
						<div class="obsidian-bisect">
							<div class="obsidian-char-box-text obsidian-char-box-text-compact">
								{{localize 'OBSIDIAN.Armour'}}
							</div>
							<div class="obsidian-horizontal-list obsidian-list-compact">
								{{#each entity.obsidian.profs.armour}}
									<span>{{this}}</span>
								{{/each}}
							</div>
						</div>
						<div class="obsidian-bisect">
							<div class="obsidian-char-box-text obsidian-char-box-text-compact">
								{{localize 'OBSIDIAN.Weapons'}}
							</div>
							<div class="obsidian-horizontal-list obsidian-list-compact">
								{{#each entity.obsidian.profs.weapons}}
									<span>{{this}}</span>
								{{/each}}
							</div>
						</div>
						<div class="obsidian-bisect">
							<div class="obsidian-char-box-text obsidian-char-box-text-compact">
								{{localize 'OBSIDIAN.Languages'}}
							</div>
							<div class="obsidian-horizontal-list obsidian-list-compact">
								{{#each data.traits.languages.value}}
									<span>{{this}}</span>
								{{/each}}
								{{#each entity.obsidian.profs.langs}}
									<span>{{this}}</span>
								{{/each}}
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="obsidian-grid-2-col obsidian-conditions-and-saves">
				<div class="obsidian-char-box-container obsidian-conditions-box"
				     style="grid-row: 1 / span 2; grid-column: 2;">
					<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Conditions'}}</div>
					<div class="obsidian-char-box obsidian-char-box-lg">
						<div class="obsidian-bisect obsidian-grid-2-col obsidian-conditions">
						{{#each ObsidianRules.CONDITIONS}}
							<div class="
							{{~#if (lookup ../entity.flags.obsidian.attributes.conditions this)~}}
								obsidian-radio-selected
							{{~/if}} obsidian-radio-label" data-value="{{this}}">
								<div class="
								{{~#if (expr '===' 'invisible' this)~}}
									obsidian-radio-positive
								{{~else~}}
									obsidian-radio-negative
								{{~/if}} obsidian-radio">
									<span></span>
								</div>
								{{i18n-join 'OBSIDIAN.Condition-' this}}
							</div>
						{{/each}}
						</div>
						<div class="
						{{~#if (expr '>' data.attributes.exhaustion.value 0)~}}
							obsidian-meatballs-active
						{{~/if}} obsidian-meatballs-title">
							{{localize 'OBSIDIAN.Exhaustion'}}
						</div>
						<div class="obsidian-meatballs obsidian-exhaustion">
							{{#each (range 1 6) as |level|}}
								<div class="
								{{~#if (expr '<=' level ../data.attributes.exhaustion.value)~}}
									obsidian-radio-selected
								{{~/if}} obsidian-radio obsidian-radio-negative" data-value="{{level}}">
									<span></span>
								</div>
							{{/each}}
						</div>
					</div>
				</div>
				<div class="obsidian-char-box-container">
					<div class="obsidian-char-box-text">
						{{localize 'OBSIDIAN.SavingThrows'}}
						<a title="{{localize 'OBSIDIAN.ManageSaves'}}" data-template="saves.html"
						   class="obsidian-edit obsidian-simple-dialog" data-width="250"
						   data-title="{{localize 'OBSIDIAN.ManageSaves'}}">
							<i class="fas fa-edit"></i>
						</a>
					</div>
					<div class="obsidian-char-box obsidian-char-box-lg obsidian-grid-2-col">
						{{#each data.abilities as |ability id|}}
							<div {{#if (expr '===' id 'dex')}}
								style="grid-row-start: 2;"
							{{else if (expr '===' id 'con')}}
								style="grid-row-start: 3;"
							{{/if}} class="obsidian-save-item" data-value="{{id}}">
								<div class="
								{{~#if ability.proficient~}}
									obsidian-radio-selected
								{{~/if}} obsidian-radio obsidian-ptr">
									<span></span>
								</div>
								<div class="obsidian-save-name rollable">
									{{i18n-join 'OBSIDIAN.Ability-' id}}
								</div>
								<div class="obsidian-save-mod obsidian-ptr">
									{{numberFormat ability.save decimals=0 sign=true}}
								</div>
							</div>
						{{/each}}
					</div>
				</div>
				<div class="obsidian-char-box-container">
					<div class="obsidian-char-box-text" style="padding: 5px 0 3px 0;">
						<span class="rollable">{{localize 'OBSIDIAN.DeathSaves'}}</span>
						<a title="{{localize 'OBSIDIAN.ManageDeathSaves'}}"
						   class="obsidian-edit obsidian-simple-dialog" data-template="death-saves.html"
						   data-title="{{localize 'OBSIDIAN.ManageDeathSaves'}}" data-width="250">
							<i class="fas fa-edit"></i>
						</a>
					</div>
					<div class="obsidian-char-box obsidian-char-box-lg">
						<div class="obsidian-grid-2-col">
							<div class="obsidian-vertical-bisect">
								<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Successes'}}</div>
								<div class="obsidian-meatballs obsidian-death-successes">
									{{#each (range 1 3) as |n|}}
										<div class="
										{{~#if (expr '<=' n ../data.attributes.death.success)~}}
											obsidian-radio-selected
										{{~/if}} obsidian-radio obsidian-radio-positive" data-value="{{n}}">
											<span></span>
										</div>
									{{/each}}
								</div>
							</div>
							<div class="obsidian-vertical-bisect">
								<div class="obsidian-char-box-text">{{localize 'OBSIDIAN.Failures'}}</div>
								<div class="obsidian-meatballs obsidian-death-failures">
									{{#each (range 1 3) as |n|}}
										<div class="
										{{~#if (expr '<=' n ../data.attributes.death.failure)~}}
											obsidian-radio-selected
										{{~/if}} obsidian-radio obsidian-radio-negative" data-value="{{n}}">
											<span></span>
										</div>
									{{/each}}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="obsidian-char-box-container obsidian-main-container">
				<div class="obsidian-char-box obsidian-main">
					<ul class="obsidian-tab-bar" data-group="main-tabs">
						<li class="obsidian-tab item" data-tab="actions">{{localize 'OBSIDIAN.Actions'}}</li>
						<li class="obsidian-tab item" data-tab="spells">{{localize 'OBSIDIAN.Spells'}}</li>
						<li class="obsidian-tab item" data-tab="equipment">{{localize 'OBSIDIAN.Equipment'}}</li>
						<li class="obsidian-tab item" data-tab="features">{{localize 'OBSIDIAN.FeaturesAndTraits'}}</li>
						<li class="obsidian-tab item" data-tab="desc">{{localize 'OBSIDIAN.Description'}}</li>
						<li class="obsidian-tab item" data-tab="notes">{{localize 'OBSIDIAN.Notes'}}</li>
						<li class="obsidian-tab item" data-tab="extras">{{localize 'OBSIDIAN.Extras'}}</li>
					</ul>
					{{> public/modules/obsidian/html/tabs/actions.html}}
				</div>
			</div>
		</section>
	</section>
</form>
